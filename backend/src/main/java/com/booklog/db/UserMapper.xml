<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.booklog.db.UserMapper">

	<!-- 회원가입 -->
	<insert id="insertUser"
		parameterType="com.booklog.model.UserDTO">
		INSERT INTO USER (USER_ID, NAME, USER_PW, NICKNAME,
		EMAIL)
		VALUES (#{userId}, #{name}, #{userPw}, #{nickname}, #{email});
	</insert>

	<!-- 중복 아이디 체크 -->
	<select id="isUserIdExists" parameterType="string"
		resultType="int">
		SELECT COUNT(*) FROM USER WHERE USER_ID = #{userId}
	</select>

	<!-- 중복 닉네임 체크 -->
	<select id="isNicknameExists" parameterType="string"
		resultType="int">
		SELECT COUNT(*) FROM USER WHERE NICKNAME = #{nickname}
	</select>

	<!-- 중복 이메일 체크 -->
	<select id="isEmailExists" parameterType="string"
		resultType="int">
		SELECT COUNT(*) FROM USER WHERE EMAIL = #{email}
	</select>

	<!-- 로그인 -->
	<select id="login" parameterType="map"
		resultType="com.booklog.model.UserDTO">
		SELECT * FROM USER
		WHERE USER_ID = #{userId} AND USER_PW =
		#{userPw}
	</select>

	<!-- 개인 정보 및 프로필 수정 -->
	<update id="updateUserInfo"
		parameterType="com.booklog.model.UserDTO">
		UPDATE USER
		SET
		<if test="nickname != null"> NICKNAME = #{nickname}, </if>
		<if test="bio != null"> BIO = #{bio}, </if>
		<if test="userPw != null"> USER_PW = #{userPw}, </if>
		<if test="name != null"> NAME = #{name}, </if>
		<if test="email != null"> EMAIL = #{email}, </if>
		<if test="profileImg != null"> PROFILE_IMG = #{profileImg}, </if>
		USER_ID = USER_ID  <!-- WHERE절 없으면 전체 수정됨 방지용 -->
		WHERE USER_ID = #{userId}
	</update>

</mapper>